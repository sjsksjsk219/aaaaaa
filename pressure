local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
    Name = "压力脚本",
    LoadingTitle = "压力脚本",
    LoadingSubtitle = "by sjsksjsk",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "脚本"
    },
    Discord = {
        Enabled = false,
        Invite = "discord.gg/Mspaint",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "压力脚本卡密系统",
        Subtitle = "点击获取链接",
        Note = "无",
        FileName = "Pressure Link",
        SaveKey = false,
        GrabKeyFromSite = true,
        Key = {"https://pastebin.com/raw/kVe5WMyJ"}
    }
})

local MainTab = Window:CreateTab("主要", nil)
local MainSection = MainTab:CreateSection("无")

Rayfield:Notify({
    Title = "欢迎使用本脚本",
    Content = "开的时候演都不要演",
    Duration = 2,
    Image = nil,
    Actions = {
        Ignore = {
            Name = "好的",
            Callback = function()
                print("用户点了好的")
            end
        },
    },
})

local Input = MainTab:CreateInput({
    Name = "速度调节",
    PlaceholderText = "请输入速度",
    RemoveTextAfterFocusLost = true,
    Callback = function(Text)
        game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = tonumber(Text) or 16
    end,
})

local Toggle = MainTab:CreateToggle({
    Name = "穿墙",
    CurrentValue = false,
    Flag = "无",
    Callback = function(Value)
        if Value then
            _G.NoclipConnection = game:GetService("RunService").Stepped:Connect(function()
                for _, part in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end)
        else
            if _G.NoclipConnection then
                _G.NoclipConnection:Disconnect()
            end
        end
    end,
})

local Toggle = MainTab:CreateToggle({
    Name = "怪来提醒",
    CurrentValue = false,
    Flag = "无",
    Callback = function(Value)
        if Value then
            if _G.MonsterAlertConnection then
                _G.MonsterAlertConnection:Disconnect()
            end

            local lastAlert = {}
            local function notifyMonster(monsterName)
                local currentTime = os.time()
                if lastAlert[monsterName] and currentTime - lastAlert[monsterName] < 5 then return end
                lastAlert[monsterName] = currentTime

                Rayfield:Notify({
                    Title = "警告!",
                    Content = monsterName .. "已生成!",
                    Duration = 5,
                })

                if _G.MonsterAlertChatEnabled then
                    game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
                        "[压力脚本] " .. monsterName .. " 已生成！", "All"
                    )
                end
            end

            _G.MonsterAlertConnection = game.Workspace.ChildAdded:Connect(function(child)
                if table.find({"Angler", "Pink", "Blitz"}, child.Name) then
                    notifyMonster(child.Name)
                end
            end)
        else
            if _G.MonsterAlertConnection then
                _G.MonsterAlertConnection:Disconnect()
                _G.MonsterAlertConnection = nil
            end
        end
    end,
})

local UniversalESP = {}
UniversalESP.__index = UniversalESP

local DEFAULT_CONFIG = {
    UpdateInterval = 2,          -- 更新间隔(秒):Int
    LoadWaitTime = 0.2,         -- 对象加载等待时间:Float
    HighlightColor = Color3.fromRGB(0, 255, 0), 
    LabelColor = Color3.fromRGB(255, 255, 255),  -- 标签颜色
    LabelSize = 18,             -- 字体大小:Int
    ShowDistance = true,        -- 显示距离:Bool
    MaxDistance = 100,          -- 最大显示距离:Int
    ExactMatch = true           -- 精确匹配:Bool
}

function UniversalESP.new(targetNames)
    local self = setmetatable({}, UniversalESP)
    self.Config = table.clone(DEFAULT_CONFIG)
    self.TargetNames = type(targetNames) == "table" and targetNames or {targetNames}
    self.Active = false
    self.Instances = {}
    self.Connections = {}
    return self
end

function UniversalESP:_safeCall(func, ...)
    local success, err = pcall(func, ...)
    if not success then warn("ESP Error:", err) end
end

function UniversalESP:_getDistance(obj)
    local char = game:GetService("Players").LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        return (char.HumanoidRootPart.Position - obj.Position).Magnitude
    end
    return math.huge
end

function UniversalESP:_createESP(obj)
    if not obj or obj:FindFirstChild("UniversalESP_Marker") then return end

    local marker = Instance.new("BoolValue")
    marker.Name = "UniversalESP_Marker"
    marker.Parent = obj

    local highlight = Instance.new("Highlight")
    highlight.Name = "UniversalESP_Highlight"
    highlight.Adornee = obj
    highlight.FillTransparency = 0.6
    highlight.OutlineTransparency = 0
    highlight.FillColor = self.Config.HighlightColor
    highlight.OutlineColor = Color3.fromRGB(255,255,255)
    highlight.Parent = obj

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "UniversalESP_Billboard"
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Adornee = obj
    billboard.Parent = obj

    local label = Instance.new("TextLabel")
    label.Text = obj.Name
    label.Size = UDim2.new(1, 0, 1, 0)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = self.Config.LabelSize
    label.TextColor3 = self.Config.LabelColor
    label.BackgroundTransparency = 1
    label.TextStrokeTransparency = 0
    label.TextStrokeColor3 = Color3.fromRGB(0,0,0)
    label.Parent = billboard

    table.insert(self.Instances, {
        Object = obj,
        Marker = marker,
        Highlight = highlight,
        Billboard = billboard,
        Label = label
    })

    if self.Config.ShowDistance then
        table.insert(self.Connections, game:GetService("RunService").Heartbeat:Connect(function()
            self:_safeCall(function()
                local dist = self:_getDistance(obj)
                if dist <= self.Config.MaxDistance then
                    label.Text = string.format("%s\n[%dm]", obj.Name, math.floor(dist))
                    billboard.Enabled = true
                else
                    billboard.Enabled = false
                end
            end)
        end))
    end
end

function UniversalESP:_isTarget(obj)
    if not obj:IsA("BasePart") and not obj:IsA("Model") then return false end
    
    for _, name in ipairs(self.TargetNames) do
        if self.Config.ExactMatch then
            if obj.Name == name then return true end
        else
            if string.find(obj.Name, name) then return true end
        end
    end
    return false
end

function UniversalESP:_scanAndAdd(parent)
    self:_safeCall(function()
        for _, obj in ipairs(parent:GetDescendants()) do
            if self:_isTarget(obj) then
                self:_createESP(obj)
            end
        end
    end)
end

function UniversalESP:Start()
    if self.Active then return end
    self.Active = true
    self:_scanAndAdd(game:GetService("Workspace"))
    table.insert(self.Connections, game:GetService("Workspace").DescendantAdded:Connect(function(obj)
        if self:_isTarget(obj) then
            task.wait(self.Config.LoadWaitTime)
            self:_createESP(obj)
        end
    end))
    table.insert(self.Connections, game:GetService("RunService").Heartbeat:Connect(function()
        if os.clock() - (self._lastUpdate or 0) > self.Config.UpdateInterval then
            self:_scanAndAdd(game:GetService("Workspace"))
            self._lastUpdate = os.clock()
        end
    end))
end

function UniversalESP:Stop()
    if not self.Active then return end
    self.Active = false
    for _, conn in ipairs(self.Connections) do
        conn:Disconnect()
    end
    self.Connections = {}
    for _, data in ipairs(self.Instances) do
        self:_safeCall(function()
            data.Highlight:Destroy()
            data.Billboard:Destroy()
            data.Marker:Destroy()
        end)
    end
    self.Instances = {}
end

function UniversalESP:SetConfig(config)
    for k, v in pairs(config) do
        if self.Config[k] ~= nil then
            self.Config[k] = v
        end
    end
    return self
end
--[[
    "workspace.GameplayFolder.Rooms.LeftStraight1["6BigDrawers"].SpawnLocations:GetChildren()[3]["Currency5-1"]",
    "workspace.GameplayFolder.Rooms.LeftStraight1:GetChildren()[13].SpawnLocations:GetChildren()[8]["Currency25-4"]",
    "workspace.GameplayFolder.Rooms.LeftStraight1:GetChildren()[13].SpawnLocations:GetChildren()[3]["Currency10-4"]"
]]--
local LockerESP = UniversalESP.new({"Locker", "柜子"})
local DoorESP = UniversalESP.new({"Door","门"})
local Money5ESP = UniversalESP.new({"Money","钱5"})
local Money25ESP = UniversalESP.new({"Money","钱25"})
local Money10ESP = UniversalESP.new({"Money","钱10"})

LockerESP:SetConfig({
    HighlightColor = Color3.fromRGB(0, 200, 255),
    LabelSide = 10,
    MaxDistance = 500
})

DoorESP:SetConfig({
    highlightColor = Color3,fromRGB(144,238,144)
})

Money5ESP:SetConflg({
    HighlightColor = Color3.fromRGB(230,190,138),
    LabelSide = 8,
    MaxDistance = 200,
    ShowDistance = false
})

Money25ESP:SetConflg({
    HighlightColor = Color3.fromRGB(230,190,138),
    LabelSide = 8,
    MaxDistance = 200,
    ShowDistance = false
})

Money10ESP:SetConflg({
    HighlightColor = Color3.fromRGB(230,190,138),
    LabelSide = 8,
    MaxDistance = 200,
    ShowDistance = false
})

local MainTab = Window:CreateTab("ESP", nil)
local MainSection = MainTab:CreateSection("无")

local Toggle = MainTab:CreateToggle({
    Name = "柜子透视",
    CurrentValue = false,
    Flag = "nil",
    Callback = function(v) 
        if v then LockerESP:Start() else LockerESP:Stop() end 
    end
})

local Toggle = MainTab:CreateToggle({
    Name = "门透视",
    CurrentValue = false,
    Flag = "nil",
    Callback = function(v)
        if v then DoorESP:Start() else DoorESP:Stop() end
    end
})

local Toggle = MainTab:CreateToggle({
    Name = "钱透视",
    CurrentValue = false,
    Flag = "nil",
    Callback = function(v)
        if v then
            Money5ESP:Start()
            Money10ESP:Start()
            Money25ESP:Start()
        else
            Money5ESP:Stop()
            Money10ESP:Stop()
            Money25ESP:Stop()
        end
    end
})
